<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bellotto neu interpretiert - Fragile Welten</title>
    <link rel="stylesheet" href="/assets/fragility_style.css">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/fav/favicon_skd_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/fav/favicon_skd_32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/img/fav/favicon_skd_48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/fav/favicon_skd_192.png">
    <link rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/img/fav/favicon_skd_167.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/img/fav/favicon_skd_180.png">
</head>

<body>
    <div id="wrapper">
        <div id="board">
            <button data-tooltip="Sand" id="sand_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Glas" id="glas_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Karten" id="karten_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Knete" id="knete_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Papier" id="papier_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Keramik" id="keramik_btn" class="btn btn_tooltip"></button>
            <button data-tooltip="Schnee" id="schnee_btn" class="btn btn_tooltip"></button>
        </div>
        <div id="frame-container">
            <div id="frame">
                <img id="frame_img_dst" class="center" src="./assets/img/Kreuzkirche.png" />
                <img id="frame_img_src" class="center" src="./assets/img/Kreuzkirche.png" />
                <div class="image-overlay">
                    <button class="close-overlay" id="close-overlay"></button>
                    <div class="overlay-content">
                        <h2 class="overlay-title">Fragile Welten</h2>
                        <p class="overlay-description">Öffne mit Künstlicher Intelligenz ein Portal in die Zukunft Dresdens. Durch das Drücken von Knöpfen kannst du verschiedene Szenarien auswählen und über fragile Materialien die Zukunft der Stadt erkunden.</p>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button data-tooltip="Info" id="info_btn" class="btn btn_tooltip"></button>
                <button data-tooltip="Home" id="home_btn" class="btn btn_tooltip">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="home-icon">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</body>
<script>

    // Home-Button event handling
    const homeBtn = document.getElementById('home_btn');
    if (homeBtn) {
        homeBtn.addEventListener('click', function () {
            window.location.href = 'index.html';
        });
        homeBtn.addEventListener('touchstart', function () {
            window.location.href = 'index.html';
        });
    }

    // Info button event handling
    const infoBtn = document.getElementById('info_btn');
    const frame = document.getElementById('frame');
    
    if (infoBtn) {
        infoBtn.addEventListener('click', function () {
            console.log("Info button clicked");
            frame.classList.add('active');
        });
    } else {
        console.error("Info button not found!");
    }

    // Close overlay when clicking close button
    document.addEventListener('click', (e) => {
        if (e.target.closest('.close-overlay')) {
            e.target.closest('#frame').classList.remove('active');
        }
    });

    // categories: (a)nimals, (e)nergies, (f)lood, (g)lobal warming, (m)obility, (n)ature, (s)pace
    const folder_names = ["Sand", "Glas", "Karten", "Knete", "Papier", "Keramik", "Schnee"];

    const ids = new Set();

    const btn_ids = ["sand_btn", "glas_btn", "karten_btn", "knete_btn", "papier_btn", "keramik_btn", "schnee_btn"];

    // js object with hardcoded path for every img of a category
    let categories = {};
    let currentCategory = null;

    // Overlay content for each category
    const overlayContents = {
        "Sand": {
            title: "Sand - Erosion und Vergänglichkeit",
            content: "Sand symbolisiert die natürliche Erosion und den stetigen Wandel der Zeit. In diesem Szenario zeigt sich Dresden als eine Stadt, die den Elementen unterworfen ist - Gebäude werden langsam von Sand umhüllt, Straßen verschwinden unter Dünen. Es ist eine Vision der Vergänglichkeit, die uns daran erinnert, wie fragil unsere gebaute Umwelt wirklich ist."
        },
        "Glas": {
            title: "Glas - Transparenz und Zerbrechlichkeit",
            content: "Glas steht für Transparenz, aber auch für extreme Zerbrechlichkeit. In dieser Interpretation wird Dresden zu einer durchsichtigen, kristallinen Stadt - schön anzusehen, aber unglaublich anfällig. Ein einziger Riss kann sich durch die gesamte Struktur ziehen und alles zum Einsturz bringen. Es symbolisiert unsere moderne, vernetzte Welt und ihre Verwundbarkeit."
        },
        "Karten": {
            title: "Karten - Planbarkeit und Orientierung",
            content: "Spielkarten repräsentieren Zufall, Strategie und die Unvorhersagbarkeit des Lebens. Dresden wird hier als ein Spiel dargestellt, bei dem die Karten neu gemischt werden können. Die Stadt verändert sich je nach dem, welche Karte gezogen wird - ein Symbol für die verschiedenen Wege, die unsere Zukunft nehmen könnte."
        },
        "Knete": {
            title: "Knete - Formbarkeit und Plastizität",
            content: "Knete symbolisiert die Formbarkeit und Anpassungsfähigkeit. Dresden wird hier als eine Stadt gezeigt, die sich ständig neu formt und verändert. Gebäude können wie Knetmasse geformt werden, Straßen biegen sich, und die gesamte Stadtlandschaft ist in einem Zustand permanenter Transformation - ein Bild für urbane Flexibilität und Anpassung."
        },
        "Papier": {
            title: "Papier - Wissen und Vergänglichkeit",
            content: "Papier steht für Wissen, Kultur und Kommunikation, aber auch für Vergänglichkeit. In dieser Vision wird Dresden zu einer Stadt aus Papier - reich an Geschichte und Kultur, aber anfällig für Feuer, Wasser und Zeit. Es ist eine Metapher für unser kulturelles Erbe und wie wichtig es ist, es zu bewahren und zu schützen."
        },
        "Keramik": {
            title: "Keramik - Tradition und Handwerk",
            content: "Keramik verbindet Tradition mit Funktionalität. Dresden wird hier als eine Stadt aus Porzellan dargestellt - elegant und kunstfertig, aber auch spröde. Es ehrt die lange Tradition der Dresdner Porzellanmanufaktur und zeigt gleichzeitig, wie Tradition und moderne Entwicklung in einem fragilen Gleichgewicht stehen."
        },
        "Schnee": {
            title: "Schnee - Reinheit und Vergänglichkeit",
            content: "Schnee symbolisiert Reinheit, Stille und den Kreislauf der Jahreszeiten. Dresden unter einer ewigen Schneeschicht zeigt eine Stadt in Winterschlaf - ruhig, friedlich, aber auch erstarrt. Es ist eine Vision von Reset und Neubeginn, aber auch von der Kälte, die entstehen kann, wenn sich nichts mehr bewegt."
        }
    };

    async function initializeCategories() {
        
        const buttons = document.querySelectorAll("button");
        buttons.forEach(button => {
            if (button.id !== "home_btn" && button.id !== "info_btn") {
                button.disabled = true;
                button.classList.add("hide_cursor");
                button.style.boxShadow = "none";
                console.log("why not");
            }
        });
        
        for (const foldername of folder_names) {
            const key = foldername[0] + foldername[1];
            const paths = [];

            let i = 1;
            while (true) {
                const imgPath = `./assets/img/img-ai/${foldername}/${foldername}${i}.png`;
                const exists = await checkImageExists(imgPath);

                if (exists) {
                    paths.push(`${foldername}/${foldername}${i}.png`);
                    i++;
                } else {
                    break;
                }
            }

            categories[key] = { "current_idx": 0, "paths": paths };
            console.log(`Category ${key} initialized with ${paths.length} images.`);

        }
    }

    function checkImageExists(url) {
        return new Promise((resolve) => {
            const img = new Image();
            img.src = url;
            img.onload = () => resolve(true);
            img.onerror = () => resolve(false);
        });
    }

    function setOverlayContent(categoryName) {
        console.log("Setting overlay content for:", categoryName);
        if (overlayContents[categoryName]) {
            frame.querySelector('.overlay-title').textContent = overlayContents[categoryName].title;
            frame.querySelector('.overlay-description').textContent = overlayContents[categoryName].content;
        }
    }

    initializeCategories().then(() => {
        
        const buttons = document.querySelectorAll("button");
        buttons.forEach(button => {
            if (button.id !== "home_btn" && button.id !== "info_btn") {
                button.disabled = false;
                button.style.boxShadow = "rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px";
                button.style.pointerEvents = "auto";
            }
        });
        
        console.log("Categories initialized.")
        btn_ids.forEach((id) => {
            const btn_event = document.getElementById(id);

            btn_event.addEventListener("click", function (event) {
                const button = event.target;
                button.classList.add('clicked');
                select_category(event);
            });
            btn_event.addEventListener("touchstart", function (event) {
                const button = event.target;
                button.classList.add('clicked');
                select_category(event);
            });
        });
    });

    function select_category(event) {

        const id_btn = event.target.id;
        const category = id_btn[0].toUpperCase() + id_btn[1];
        ids.add(id_btn);

        // Store current category for info button
        const categoryName = folder_names.find(name => name.startsWith(category));
        currentCategory = categoryName;

        const btn = document.getElementById(id_btn)
        const board = document.getElementById("board");
        
        btn.style.boxShadow = "none";
        btn.style.pointerEvents = "none";
        btn.style.cursor = "pointer";
        
        board.classList.add("active");

        const infoBtn = document.getElementById("info_btn");
        infoBtn.classList.add("active");

        document.getElementById('frame').classList.remove('active');

        // Set overlay content for the selected category
        if (categoryName) {
            setOverlayContent(categoryName);
        }

        if (category) {

            btn_ids.forEach((id) => {
                const btn = document.getElementById(id);
                btn.style.boxShadow = "none";
                btn.style.pointerEvents = "none";
                btn.style.cursor = "pointer";
            });
            changeImage(getImageByCategories(category));

            setTimeout(function () {
                board.classList.remove("active");
                btn_ids.forEach((id) => {
                    const btn = document.getElementById(id);
                    btn.style.boxShadow = "rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px";
                    btn.style.pointerEvents = "auto";
                    console.log("hallo");
                });
            }, 13900);
        }
    }

    async function changeImage(srcImage) {
        const buttons = document.querySelectorAll('button');
        const img = document.getElementById('frame_img_dst');
        const board = document.getElementById('board');
        const btns = Array.from(document.getElementsByClassName('btn'))

        img.src = srcImage;
        await img.decode();
        img.style.opacity = 1;

        board.classList.add("hide_cursor");
        btns.forEach(b => {
            b.classList.add("hide_cursor");
        });
        buttons.forEach(button => {
            if (button.id !== "home_btn" && button.id !== "info_btn" && button.id !== "close-overlay") {
                button.disabled = true;
                button.classList.add("hide_cursor");
                button.style.boxShadow = "none";
            }
            
        });

        setTimeout(function () {
            img.style.opacity = 0;
        }, 10000);

        setTimeout(function () {
            btns.forEach(b => {
                b.classList.remove("hide_cursor");
            });
            buttons.forEach(button => {
                button.disabled = false;
                button.classList.remove("clicked");
                button.classList.remove("hide_cursor");
                board.classList.remove("hide_cursor");
            });
            document.getElementById('frame').classList.remove('active');
            document.getElementById("info_btn").classList.remove("active");
        }, 13701);
    }

    function getImageByCategories(category) {
        const list = categories[category]["paths"];
        console.log("list length: " + list.length);
        console.log("categories[category][paths]: " + list[categories[category]["current_idx"]]);
        categories[category]["current_idx"] = (categories[category]["current_idx"] + 1) % list.length;
        return "./assets/img/img-ai/" + list[categories[category]["current_idx"]];
    }

</script>

</html>